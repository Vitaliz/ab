/*! ab - v0.0.1 - 2014-03-08 */
!function(){function a(){this._events={}}function b(a,b){this.name=a,this.forced=!!b}function c(a,b){this.name=a,this.traffic=b,this.slice=null,this.storage=d("local")?window.localStorage:new e("local"),this._slices={}}var d=function(a){var b="test";try{return window[a+"Storage"].setItem(b,b),window[a+"Storage"].removeItem(b),!0}catch(c){return!1}},e=function(a){function b(a,b,c){var d,e;c?(d=new Date,d.setTime(d.getTime()+24*c*60*60*1e3),e="; expires="+d.toGMTString()):e="",document.cookie=a+"="+b+e+"; path=/"}function c(a){var b,c,d=a+"=",e=document.cookie.split(";");for(b=0;b<e.length;b++){for(c=e[b];" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(d))return c.substring(d.length,c.length)}return null}function d(c){c=JSON.stringify(c),"session"===a?window.name=c:b("localStorage",c,365)}function e(){"session"===a?window.name="":b("localStorage","",365)}function f(){var b="session"===a?window.name:c("localStorage");try{return b?JSON.parse(b):{}}catch(d){return{}}}var g=f();return{length:0,clear:function(){g={},this.length=0,e()},getItem:function(a){return void 0===g[a]?null:g[a]},key:function(a){var b=0;for(var c in g){if(b==a)return c;b+=1}return null},removeItem:function(a){delete g[a],this.length-=1,d(g)},setItem:function(a,b){g[a]=b+"",this.length+=1,d(g)}}};a.prototype.trigger=function(a){var b=Array.prototype.slice.call(arguments,1);if(this._events.hasOwnProperty(a))for(var c=0,d=this._events[a].length;d>c;c++)this._events[a][c].apply(window,b)},a.prototype.on=function(a,b){this._events.hasOwnProperty(a)||(this._events[a]=[]),this._events[a].push(b)},c.prototype.slices=function(a){if(null!==this.slice)throw new Error("Attempted to add slices to already running test.");"[object Array]"!==Object.prototype.toString.call(a)&&(a=Array.prototype.slice.call(arguments,0));for(var c=0,d=a.length;d>c;c++)this.add(new b(a[c]));return this},c.prototype.add=function(a){return this._slices[a.name]=a,this},c.prototype.run=function(a){var c=this.urlSlice(),d=this.storedSlice();return c&&this.hasSlice(c)?(this.slice=this._slices[c],this.slice.forced=!0):d===!1?this.slice=new b("control"):null!==d&&this.hasSlice(d)?this.slice=this._slices[d]:Math.random()>this.traffic?(this.slice=new b("control"),this.storage.setItem(this.key(),JSON.stringify(!1)),h.events.trigger("start",this)):(this.slice=this.chooseSlice(),this.storage.setItem(this.key(),JSON.stringify(this.slice.name)),h.events.trigger("start",this)),"function"==typeof a&&a.call(this),h.events.trigger("run",this),this},c.prototype.chooseSlice=function(){var a=[];for(var c in this._slices)this._slices.hasOwnProperty(c)&&a.push(c);if(0===a.length)return new b("control");var d=Math.floor(Math.random()/(1/a.length));return this._slices[a[d]]},c.prototype.hasSlice=function(a){return this._slices.hasOwnProperty(a)},c.prototype.urlSlice=function(){var a,b=window.location.hash,c=window.location.search,d=new RegExp("("+this.key()+")=([\\w0-9]+)");return(a=b.match(d))?a[2]:(a=c.match(d))?a[2]:!1},c.prototype.storedSlice=function(){try{return JSON.parse(this.storage.getItem(this.key()))}catch(a){return null}},c.prototype.key=function(){return h.config.STORAGE_PREFIX+this.name},c.prototype.clear=function(){var a=d("local")?window.localStorage:new e("local");a.removeItem(this.key())},c.prototype.style=function(a){var b=document.createElement("link");return b.rel="stylesheet",b.href=a,document.head.appendChild(b),this},c.prototype.script=function(a,b){var c=document.createElement("script");c.type="text/javascript",c.async="undefined"==typeof b?!0:!!b,c.src=a;var d=document.getElementsByTagName("script")[0];return d.parentNode.insertBefore(c,d),this};var f={},g=window.ab,h=function(a,b,d){return f.hasOwnProperty(a)?f[a]:("undefined"==typeof b&&(b=1),f[a]=new c(a,b),d&&d.length&&f[a].slices(d),f[a])};h.clear=function(){for(var a in f)f.hasOwnProperty(a)&&f[a].clear();f={}},h.noConflict=function(){return window.ab=g,h},h.events=new a,h.version="0.0.1",h.config={STORAGE_PREFIX:"ab:"},h.Test=c,h.Slice=b,h.Storage=e,h.Events=a,"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require?module.exports=h:"function"==typeof define&&define.amd?define("ab",function(){return h}):window.ab=h}();